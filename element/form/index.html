<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>目标 | Ace</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/Ace.Blog/logo.png">
    <link rel="manifest" href="/Ace.Blog/manifest.json">
    <link rel="apple-touch-icon" href="/Ace.Blog/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/Ace.Blog/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="ace blog">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/Ace.Blog/assets/css/0.styles.d44ed3c7.css" as="style"><link rel="preload" href="/Ace.Blog/assets/js/app.d3974293.js" as="script"><link rel="preload" href="/Ace.Blog/assets/js/2.0968e3c9.js" as="script"><link rel="preload" href="/Ace.Blog/assets/js/16.fc8c687e.js" as="script"><link rel="prefetch" href="/Ace.Blog/assets/js/10.857a411d.js"><link rel="prefetch" href="/Ace.Blog/assets/js/11.bc091e0e.js"><link rel="prefetch" href="/Ace.Blog/assets/js/12.89183f5b.js"><link rel="prefetch" href="/Ace.Blog/assets/js/13.29c68460.js"><link rel="prefetch" href="/Ace.Blog/assets/js/14.8ed1ca88.js"><link rel="prefetch" href="/Ace.Blog/assets/js/15.c158f098.js"><link rel="prefetch" href="/Ace.Blog/assets/js/17.e20e25f8.js"><link rel="prefetch" href="/Ace.Blog/assets/js/18.1698a641.js"><link rel="prefetch" href="/Ace.Blog/assets/js/19.df689c41.js"><link rel="prefetch" href="/Ace.Blog/assets/js/3.fc62896d.js"><link rel="prefetch" href="/Ace.Blog/assets/js/4.4d64059e.js"><link rel="prefetch" href="/Ace.Blog/assets/js/5.a33e5707.js"><link rel="prefetch" href="/Ace.Blog/assets/js/6.8b090542.js"><link rel="prefetch" href="/Ace.Blog/assets/js/7.05f834a2.js"><link rel="prefetch" href="/Ace.Blog/assets/js/8.7dff8a46.js"><link rel="prefetch" href="/Ace.Blog/assets/js/9.a476501b.js">
    <link rel="stylesheet" href="/Ace.Blog/assets/css/0.styles.d44ed3c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Ace.Blog/" class="home-link router-link-active"><!----> <span class="site-name">Ace</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS/TS" class="dropdown-title"><span class="title">JS/TS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Ace.Blog/TS/Axios/" class="nav-link">
  Axios
</a></li></ul></div></div><div class="nav-item"><a href="/Ace.Blog/DataStructure/DataStructure/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/Ace.Blog/element/form/" class="nav-link router-link-exact-active router-link-active">
  UI 组件
</a></div> <a href="https://github.com/Been101/Ace.Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JS/TS" class="dropdown-title"><span class="title">JS/TS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Ace.Blog/TS/Axios/" class="nav-link">
  Axios
</a></li></ul></div></div><div class="nav-item"><a href="/Ace.Blog/DataStructure/DataStructure/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/Ace.Blog/element/form/" class="nav-link router-link-exact-active router-link-active">
  UI 组件
</a></div> <a href="https://github.com/Been101/Ace.Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>UI 组件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Ace.Blog/element/form/" class="active sidebar-link">Form表单</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Ace.Blog/element/form/#目标" class="sidebar-link">目标</a></li><li class="sidebar-sub-header"><a href="/Ace.Blog/element/form/#el-input" class="sidebar-link">el-input</a></li><li class="sidebar-sub-header"><a href="/Ace.Blog/element/form/#el-form-item" class="sidebar-link">el-form-item</a></li><li class="sidebar-sub-header"><a href="/Ace.Blog/element/form/#el-form" class="sidebar-link">el-form</a></li><li class="sidebar-sub-header"><a href="/Ace.Blog/element/form/#完整的代码" class="sidebar-link">完整的代码</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h2> <ul><li>实现 elForm
<ul><li>指定数据、校验规则</li></ul></li> <li>elFormItem
<ul><li>label 标签添加</li> <li>执⾏校验</li> <li>显示错误信息</li></ul></li> <li>elInput
<ul><li>维护数据</li></ul></li></ul> <h2 id="el-input"><a href="#el-input" class="header-anchor">#</a> el-input</h2> <p>维护数据</p> <ul><li>输入框输入的值， 或者是单选框，复选框选中的值， 亦或者是下拉菜单， datePicker 等值。</li></ul> <p>el-input 是对 input 的简单封装, el-input 的用法</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>而 v-model= 'name' 是 :value = 'name' @input = 'name = value' 的语法糖</p> <p>所以 el-input.vue 的简单实现可以是下面这样的。</p> <p><code>el-input.vue</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>value<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Oninput<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">Oninput</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="el-form-item"><a href="#el-form-item" class="header-anchor">#</a> el-form-item</h2> <p>el-form-item 对表单元素进行二次封装主要功能有 3 个</p> <ul><li>添加 label 标签</li> <li>执行校验</li> <li>显示错误信息</li></ul> <p>el-form-item 的基本用法可能是这样的</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">lable</span> <span class="token attr-value"><span class="token punctuation">=</span> <span class="token punctuation">'</span>用户名:<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span> <span class="token attr-value"><span class="token punctuation">=</span> <span class="token punctuation">'</span>name<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>el-form-item 中要显示的错误信息是由 el-form 的 rules 传入的，校验规则有可能有好多， 具体显示哪个是由 el-form-item 校验后选择的。</p> <p>如校验规则有 2 条</p> <ul><li>必填项，不能为空</li> <li>长度在 6 - 12 之间</li></ul> <p>经过校验 如果不符合第一条，则显示第一天错误信息， 否则显示第二条错误信息。</p> <p>则 el-form-item 维护的 状态 有 error, 外部传入的状态有 label, rules。</p> <p>又因为 el-form-item 中除了放 el-input 还可以放 el-checkbox, el-select 等，所以需要 用到 solt 进行插入。</p> <p><code>el-form-item.vue</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>{{label}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>error<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{error}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      rules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Array<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        error<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>什么时候改变 error 的值，也就是说什么时候开始校验，是在 el-input 的值改变的时候, 我们需要 在 el-input 值改变的时候向外派发一个校验事件 validate</p> <p><code>el-input.vue</code></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-arrow deleted">&lt;template&gt;
</span><span class="token unchanged">    &lt;input :value = 'value' @input = 'Oninput'&gt;
</span><span class="token deleted-arrow deleted">&lt;/template&gt;
&lt;script&gt;
</span>export default {
<span class="token unchanged">    data() {
        return {
            value: ''
        }
    },
    methods: {
        Oninput(e) {
            this.$emit('input', e.target.value)
        }
    }
</span>}
<span class="token deleted-arrow deleted">&lt;/script&gt;
</span></code></pre></div><p><code>el-input.vue</code></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token unchanged"> Oninput(e) {
   this.$emit('input', e.target.value)
</span><span class="token inserted-sign inserted">+  this.$emit('validate', e.target.value) // 传入值并通知父元素可以校验啦
</span><span class="token unchanged"> }
</span></code></pre></div><p>el-form-item 中怎么监听这个事件呢，由于 el-input 是通过 slot 插入的， 在 slot 上添加 @validate= 'onValidate' 是监听不到的。</p> <p>我们可以让 el-form-item 自己派发， 自己监听, 那么 <code>el-input.vue</code> 中应该修改成这样</p> <div class="language-diff extra-class"><pre class="language-diff"><code>Oninput(e) {
<span class="token unchanged">   this.$emit('input', e.target.value)
</span><span class="token deleted-sign deleted">-  this.$emit('validate', e.target.value) // 传值并通知父元素可以校验啦
</span><span class="token inserted-sign inserted">+  this.$parent.$emit('validate', e.target.value) // 让父组件自己 管理事件派发和监听
</span>}
</code></pre></div><p><code>el-form-item.vue</code></p> <p>此处执行校验用到了第三方库， <code>async-validate</code>, 提前 install, 并在 el-form-item.vue 中 import 进来。</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted-sign inserted">+  mounted() {
+   this.$on('validate', (val) =&gt; this.validate(val))
+ }
</span>methods: {
<span class="token inserted-sign inserted">+   validate(val) {
+     // 拿到输入的值
+     // const value = val
+     // 拿到校验规则 rules， 父元素传进来的，直接用
+       const rules = this.rules
+     // 进行校验
+        if (!rules) {
+          return Promise.resolve(true);
+        }
+        // 创建描述对象
+        const descriptor = { [this.prop]: rules };
+        // 创建校验函数
+        const validator = new Schema(descriptor);
+        // 校验
+        return validator.validate({ [this.prop]: value }, errors =&gt; {
+          if (errors) {
+            this.error = errors[0].message;
+          } else {
+            this.error = &quot;&quot;;
+          }
+        });
+   }
</span>}
</code></pre></div><p>此时这样已经可以使用了，用法应该是这样的</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>用户名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:rules</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rules.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>密码<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:rules</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rules.password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> Schema <span class="token keyword">from</span> <span class="token string">'async-validator'</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        rulse<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">'必填项， 不能为空'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> min<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">'长度在6-12之间'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          password<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">'不填密码怎么登录'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">'密码这么长， 能记得住吗'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>和咱们平时使用的 el-form-item 用法不太一样, 数据 model 和 规则 rules 都是由 el-form 管理的。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form</span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>model<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:rules</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>rules<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>用户名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>model.name<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>密码<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>model.password<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> Schema <span class="token keyword">from</span> <span class="token string">'async-validator'</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        model<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        rulse<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          name<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">'必填项， 不能为空'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> min<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">'长度在6-12之间'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          password<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">'不填密码怎么登录'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> max<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token string">'密码这么长， 能记得住吗'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="el-form"><a href="#el-form" class="header-anchor">#</a> el-form</h2> <p>el-form 的主要功能是指定数据和校验规则</p> <p>用法就如同上面那样</p> <p>el-form 的简单实现可能是这样的</p> <p><code>el-form.vue</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      model<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      rules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>el-form 中的 model 和 rules 怎么传递给 el-form-item 和 el-input 呢，使用 provide 和 inject 进行 父和后代组件进行通信。</p> <p>provide 和 inject 绑定并不是可响应的。这是刻意为之的。然而，如果你传入了一个可监听的对象，那么其对象的属性还是可响应的。所以我们把 this 传递下去， 后代组件拿到 el-form 组件实例之后就可以轻松访问 model， rules 等 属性和方法。</p> <p><code>el-form.vue</code></p> <div class="language-diff extra-class"><pre class="language-diff"><code>
<span class="token deleted-arrow deleted">&lt;template&gt;
</span><span class="token unchanged">  &lt;div&gt;
    &lt;slot&gt;&lt;/slot&gt;
  &lt;/div&gt;
</span><span class="token deleted-arrow deleted">&lt;/template&gt;
&lt;script&gt;
</span><span class="token unchanged">  export default {
</span><span class="token inserted-sign inserted">+    provide() {
+      return {
+        form: this
+      }
+    },
</span><span class="token unchanged">    props: {
      model: {
        type: Object,
        default() {
          return {}
        },
      },
      rules: {
        type: Object,
        default() {
          return {}
        },
      },
    },
  }
</span><span class="token deleted-arrow deleted">&lt;/script&gt;
</span></code></pre></div><p>而 el-form-item 中获取 value 和 rules 的方法就要改变一下了</p> <p>el-input 派发 validate 事件的时候也不用 传值了</p> <p><code>el-input.vue</code></p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted">- this.$parent.$emit('validate', e.target.value)
</span><span class="token inserted-sign inserted">+ this.$parent.$emit('validate') // 只需要通知， 可以校验啦， 就行了
</span>
</code></pre></div><p><code>el-form-item.vue</code></p> <div class="language-diff extra-class"><pre class="language-diff"><code>export default {
<span class="token inserted-sign inserted">+  inject: ['form'], // 注入祖先组件， 传进来的数据
</span><span class="token unchanged">  props: {
    label: {
      type: String,
      default: ''
    },
    prop: {
      type: String,
      default: ''
    }
  },
  mounted() {
</span><span class="token deleted-sign deleted">-   this.$on('validate', (val) =&gt; this.validate(val))
</span><span class="token inserted-sign inserted">+   this.$on('validate', () =&gt; this.validate())
</span><span class="token unchanged">  }
  methods: {
</span><span class="token deleted-sign deleted">-    validate(val) {
</span><span class="token inserted-sign inserted">+    validate() {
</span><span class="token unchanged">      // 拿到输入的值
</span><span class="token deleted-sign deleted">-     const value = val  // 拿到对应的值
</span><span class="token inserted-sign inserted">+     const value = this.form.model[this.prop] // 拿到对应的值
</span><span class="token deleted-sign deleted">-      // 拿到校验规则 rules， 父元素传进来的，直接用
-        const rules = this.rules
</span><span class="token inserted-sign inserted">+     const rules = this.form.rules[this.prop] // 拿到对应的规则
</span>
<span class="token unchanged">      // 进行校验
      if (!rules) {
        return Promise.resolve(true);
      }
      // 创建描述对象
      const descriptor = { [this.prop]: rules };
      // 创建校验函数
      const validator = new Schema(descriptor);
      // 校验
      return validator.validate({ [this.prop]: value }, errors =&gt; {
        if (errors) {
          this.error = errors[0].message;
        } else {
          this.error = &quot;&quot;;
        }
      });
    }
  }
</span>}

</code></pre></div><h2 id="完整的代码"><a href="#完整的代码" class="header-anchor">#</a> <a href="https://github.com/Been101/blog-examples/tree/master/src/components/Form" target="_blank" rel="noopener noreferrer">完整的代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Been101/Ace.Blog/edit/master/src/docs/element/form/index.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/23/2020, 3:02:36 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/Ace.Blog/assets/js/app.d3974293.js" defer></script><script src="/Ace.Blog/assets/js/2.0968e3c9.js" defer></script><script src="/Ace.Blog/assets/js/16.fc8c687e.js" defer></script>
  </body>
</html>
